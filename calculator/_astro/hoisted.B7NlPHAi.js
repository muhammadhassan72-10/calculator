import{C as l}from"./commands.xPwo0_L0.js";import{C as p,a as g}from"./calculator-toast.service.r6FV5G6C.js";import{C as n,e as y,a as m}from"./auth.service.CYhfz_Ml.js";import{I as f}from"./instance-manager.BK3A94JX.js";import{a as c}from"./authStore.CN9YIAzg.js";import{C as v}from"./CalculatorSessionUtils.yz2CW3RD.js";import"./text_unknown_error_occurred.D3589rme.js";import"./runtime.DXWTVdIs.js";import"./utils.Cz7UNdBz.js";import"./clsx.B-dksMZM.js";import"./bundle-mjs.D3-g1QD1.js";import"./index.BcueH52X.js";import"./hydration.C4XjvPX6.js";import"./utils.B-ZhoiGS.js";class I extends HTMLElement{resultObject;latex;targetElement;elementType;insertMatrixItem;insertToEditorItem;separators;resultFormatItem;copyPlainTextItem;copyLatexItem;copyImageItem;closeItem;pasteItem;selectAllItem;menu;calculatorService;visibleState={};constructor(){super(),this.menu=this.querySelector("menu"),this.insertMatrixItem=this.querySelector('li[data-name="insert-matrix"]'),this.insertToEditorItem=this.querySelector('li[data-name="insert-to-editor"]'),this.resultFormatItem=this.querySelector('li[data-name="result-format"]'),this.copyPlainTextItem=this.querySelector('li[data-name="copy-plain-text"]'),this.copyLatexItem=this.querySelector('li[data-name="copy-latex"]'),this.copyImageItem=this.querySelector('li[data-name="copy-image"]'),this.closeItem=this.querySelector('li[data-name="close"]'),this.pasteItem=this.querySelector('li[data-name="paste"]'),this.selectAllItem=this.querySelector('li[data-name="select-all"]'),this.separators=Array.from(this.querySelectorAll('li[role="separator"]')),this.addEventListener("mousedown",e=>{this.hide(),e.preventDefault(),e.stopPropagation()}),this.menu.addEventListener("mousedown",e=>{e.preventDefault(),e.stopPropagation()}),this.calculatorService=p.getInstance()}init(e){this.addEventListener("mousedown",i=>{i.preventDefault(),i.stopPropagation()}),this.addEventListener("click",i=>{this.hide()}),this.insertMatrixItem.addEventListener("click",i=>{e.executeCommands([l.openInsertMatrixDialog,!0]),n.sendMathContextMenuEvent("insert-matrix")}),this.insertToEditorItem.addEventListener("click",i=>{this.latex&&(e.executeCommands([l.insert,this.latex,{scrollIntoView:!0}]),n.sendMathContextMenuEvent("insert-to-editor"))}),this.resultFormatItem.addEventListener("click",i=>{this.resultObject&&(e.executeCommands([l.openResultFormatDialog,!0,this.resultObject]),n.sendMathContextMenuEvent("result-format"))}),this.copyPlainTextItem.addEventListener("click",i=>{if(!this.latex&&this.elementType!=="math-input")return;let t=this.latex;this.elementType==="math-input"&&(t=this.targetElement.value),e.executeCommands([l.copy,{targetFormat:"plaintext",sourceFormat:"NCalcLatex",value:t}])}),this.copyLatexItem.addEventListener("click",i=>{if(!this.latex&&this.elementType!=="math-input")return;let t=this.latex;this.elementType==="math-input"&&(t=this.targetElement.value),e.executeCommands([l.copy,{targetFormat:"latex",sourceFormat:"NCalcLatex",value:t}])}),this.copyImageItem.addEventListener("click",i=>{this.latex&&n.sendMathContextMenuEvent("copy-image")}),this.selectAllItem.addEventListener("click",i=>{if(this.elementType!=="math-input")return;this.targetElement.selectAll()}),this.pasteItem.addEventListener("click",i=>{this.elementType==="math-input"&&(navigator.clipboard.readText().then(t=>{f.getCalculator().executeCommands([l.paste,t])}).catch(t=>{g.show({message:"Unknown error occurred",type:"error"})}),n.sendMathContextMenuEvent("paste-to-input"))}),this.closeItem.addEventListener("click",i=>{this.hide(),n.sendMathContextMenuEvent("click-close")})}bindingData({resultObject:e,latex:i,targetElement:t,elementType:a}){this.resultObject=e,this.latex=i,this.targetElement=t,this.elementType=a}show(e){if(!this.resultObject&&!this.latex&&!this.targetElement&&!this.elementType)return;this.elementType==="math-input"&&this.targetElement&&!this.targetElement.readOnly?(this.visibleState.pasteItem=!0,this.visibleState.selectAllItem=!0,this.visibleState.insertMatrixItem=!0):(this.visibleState.pasteItem=!1,this.visibleState.selectAllItem=!1,this.visibleState.insertMatrixItem=!1),this.visibleState.resultFormatItem=!!this.resultObject,this.latex?(this.visibleState.insertToEditorItem=!0,this.visibleState.copyLatexItem=!0,this.visibleState.copyPlainTextItem=!0):(this.visibleState.insertToEditorItem=!1,this.visibleState.copyLatexItem=!1,this.visibleState.copyPlainTextItem=!1),this.elementType==="math-input"&&(this.visibleState.copyLatexItem=!0,this.visibleState.copyPlainTextItem=!0),this.visibleState.copyImageItem=!1;for(let h in this.visibleState)this.visibleState[h]?this[h].style.removeProperty("display"):this[h].style.display="none";this.visibleState.resultFormatItem?this.separators[0].style.removeProperty("display"):this.separators[0].style.display="none",this.visibleState.insertMatrixItem||this.visibleState.insertToEditorItem?this.separators[1].style.removeProperty("display"):this.separators[1].style.display="none";let i=e.clientX,t=e.clientY,a=window.innerWidth,r=window.innerHeight,o=this.menu.offsetWidth,u=this.menu.offsetHeight;i=Math.min(a-o,i),t=Math.min(r-u,t),this.menu.style.left=`${i}px`,this.menu.style.top=`${t}px`,this.style.visibility="visible",this.menu.classList.remove("hide"),this.menu.classList.add("show"),n.sendMathContextMenuEvent("open")}hide(){this.menu.classList.remove("show"),this.menu.classList.add("hide"),this.style.visibility="hidden",this.targetElement=void 0,this.latex=void 0,this.resultObject=void 0,this.elementType=void 0}}customElements.define("math-context-menu",I);function x(s,e,i=5,t=1e3){let a=0;function r(){typeof google<"u"&&google.accounts&&google.accounts.id?e():a<i?(a++,console.warn(`Google script not loaded yet. Retrying (${a}/${i})...`),setTimeout(r,t)):console.error("Failed to load Google script within the retry limit.")}if(document.querySelector(`script[src="${s}"]`))r();else{const o=document.createElement("script");o.src=s,o.async=!0,o.defer=!0,o.onload=r,o.onerror=()=>console.error("Failed to load Google script."),document.head.appendChild(o)}}function S(){try{if(google.accounts.id.initialize({client_id:"440702260673-g5v29uuaa4uvlt7o6uiepnnlg5855sh1.apps.googleusercontent.com",use_fedcm_for_prompt:!0,itp_support:!0,callback:y}),setTimeout(()=>{c.setKey("isGoogleInitFinished",!0)},1e3),!m.getInstance().isAuthenticated){let s=3e4;T(s),console.log("Show OneTap login in ",s,"ms"),setTimeout(()=>{!c.get().isShowGoogleOneTap&&!m.getInstance().isAuthenticated&&(google.accounts.id.prompt(),c.setKey("isShowGoogleOneTap",!0),console.log("Show OneTap login"))},s)}}catch(s){console.error("Error initializing Google login:",s)}}x("https://accounts.google.com/gsi/client",S);function T(s){let e=v.getSessionInfo();if(!e.firstUseAt)return;let i=(new Date().getTime()-e.firstUseAt.getTime())/1e3/60/60;if(i<1){console.log("Not show login dialog, first time using differ ",i);return}if(e.skipLoginRequestAt){let t=(new Date().getTime()-e.skipLoginRequestAt.getTime())/1e3/60/60;if(t<24){console.log("Not show login dialog, skipped in ",t,"hours");return}}try{if(m.getInstance().isAuthenticated)console.log("Not show login dialog because authenticated");else{let t=s;console.log("Open login dialog in ",t/1e3,"s"),setTimeout(()=>{m.getInstance().isAuthenticated||loginDialog.showModal()},t)}}catch(t){console.log("Auto Open Login dialog got error: ",t)}}let d=window.location.hostname==="mathda.com";console.log("Run ads script",d);window.googletag=window.googletag||{cmd:[]};googletag.cmd.push(function(){let s=d?"/93656639,23005229157/mathda.com/mathda.com_header":"/6355419/Travel/Europe",e=googletag.sizeMapping().addSize([1010,930],[[970,90],[728,90]]).addSize([728,930],[[728,90]]).addSize([320,930],[[320,100],[320,50],[300,50]]).addSize([320,850],[[320,50],[300,50]]).addSize([0,0],[]).build();googletag.defineSlot(s,[[970,90],[728,90],[320,100],[320,50],[300,50]],"div-gpt-ad-1733391140069-0").defineSizeMapping(e).addService(googletag.pubads()),googletag.pubads().enableSingleRequest(),googletag.enableServices()});
